Sat Nov 23 16:24:04 1996  Thomas Bushnell, n/BSG  <thomas@gnu.ai.mit.edu>

	* file-set-translator.c (netfs_S_file_set_translator): Delete var
	I. 

Wed Nov 20 17:13:13 1996  Miles Bader  <miles@gnu.ai.mit.edu>

	* fsys-syncfs.c (netfs_S_fsys_syncfs): Use iohelp_create_iouser, not
	iohelp_make_iouser.

Mon Nov 18 17:06:39 1996  Thomas Bushnell, n/BSG  <thomas@gnu.ai.mit.edu>

	* netfs.h (netfs_report_access): Return error_t.
	* file-check-access.c (netfs_S_file_check_access): Deal with
	errors from netfs_report_access.

Sat Nov 16 17:17:50 1996  Thomas Bushnell, n/BSG  <thomas@gnu.ai.mit.edu>

	* io-restrict-auth.c (netfs_S_io_restrict_auth): Fix several typos.

	* fsys-getroot.c (netfs_S_fsys_getroot): iohelp_make_iouser ->
	iohelp_create_iouser.  New arg syntax for fshelp_fetch_root.

Fri Nov 15 13:39:03 1996  Thomas Bushnell, n/BSG  <thomas@gnu.ai.mit.edu>

	* netfs.h (struct protid): Replace member `credential' with `user'
	of new type.  All uses of old `credential' member changed to
	use `user' member.
	Change all functions that used to take `struct netcred' args to
	take `struct iouser' args.  All callers changed.
	(netfs_copy_credential, netfs_dropy_credential,
 	netfs_make_credential): Delete functions.
	* dir-lookup.c (netfs_S_dir_lookup): netfs_copy_credential ->
	iohelp_dup_iouser.
	* dir-mkfile.c (netfs_S_dir_mkfile): Likewise.
	* file-exec.c (netfs_S_file_exec): Likewise.
	* io-duplicate.c (netfs_S_io_duplicate): Likewise.
	* release-protid.c (netfs_release_protid): netfs_drop_credential
	-> iohelp_free_iouser.
	* dir-lookup.c (netfs_S_dir_lookup): Omit uses of
	netfs_interpret_credential; do it with new structures.
	* file-exec.c (netfs_S_file_exec): Likewise.
	* file-getcontrol.c (netfs_S_file_getcontrol): Likewise.
	* file-set-translator.c (netfs_S_file_set_translator): Likewise;
	using fshelp_isowner for permission check.
	* io-restrict-auth.c (netfs_S_io_restrict_auth): Likewise; guts
	rewritten. 
	* dir-lookup.c (netfs_S_dir_lookup): netfs_make_credential ->
	iohelp_make_iouser. 
	* fsys-getroot.c (netfs_S_fsys_getroot): Likewise.
	* fsys-syncfs.c (netfs_S_fsys_syncfs): Likewise.
	* io-reauthenticate.c (netfs_S_io_reauthenticate): Use
	iohelp_reauth instead of doing it by hand.

Mon Oct 21 21:56:33 1996  Thomas Bushnell, n/BSG  <thomas@gnu.ai.mit.edu>

	* netfs.h: Add extern inline protection.
	* netfs.c: New file.
	* Makefile (OTHERSRCS): Add netfs.c.

Wed Sep 18 12:56:05 1996  Miles Bader  <miles@gnu.ai.mit.edu>

	* std-runtime-argp.c <argp.h>: New include.
	* std-startup-argp.c <argp.h>: New include.
	* fsys-get-options.c (netfs_S_fsys_get_options): Initialize ARGZ
	with the program name, and call netfs_append_args instead of
	netfs_get_options.
	* file-get-fs-options.c (netfs_S_file_get_fs_options): Likewise.
	* append-std-options.c (netfs_append_std_options): Doc fix.
	* netfs.h (netfs_append_args): New declaration.
	(netfs_get_options): Declaration removed.
	<argp.h>: Include removed.
	* append-args.c (netfs_append_args): New file.
	* Makefile (OTHERSRCS): Replace get-options.c with append-args.c

	* file-get-translator.c <stdio.h>: New include.

Fri Aug 16 19:20:22 1996  Thomas Bushnell, n/BSG  <thomas@gnu.ai.mit.edu>

	* priv.h (end_using_protid_port): Only call ports_port_deref if
	CRED is set.

Fri Jul 26 14:34:11 1996  Miles Bader  <miles@gnu.ai.mit.edu>

	* file-exec.c (netfs_S_file_exec): Unlock NP before we attempt to
 	do setuid/setgid (which otherwise can deadlock during port reauth).
	Pay attention to the error code returned by fshelp_exec_reauth,
	and don't make NEWPI if it's an error.

Tue Jul 23 14:28:33 1996  Miles Bader  <miles@gnu.ai.mit.edu>

	* file-utimes.c (netfs_S_file_utimes): `struct timespec' now uses
	a field prefix of `tv_'.

Thu Jul 18 23:09:54 1996  Michael I. Bushnell, p/BSG  <mib@gnu.ai.mit.edu>

	* io-reauthenticate.c (netfs_S_io_reauthenticate): After attaching
	credential to NEWPI, install it in NETFS_PORT_BUCKET->portset.
	* make-protid.c (netfs_make_protid): If CRED is null, use
	noinstall version of ports_create_port.

Sat Jul 13 20:10:02 1996  Michael I. Bushnell, p/BSG  <mib@gnu.ai.mit.edu>

	* io-reauthenticate.c (netfs_S_io_reauthenticate): Repeat
 	auth_server_authenticate for as long as we get EINTR.  Tolerate
 	other errors without crashing as well.

Sun Jul  7 21:28:54 1996  Michael I. Bushnell, p/BSG  <mib@gnu.ai.mit.edu>

	* io-reauthenticate.c (netfs_S_io_reauthenticate): Don't use
 	unsafe MOVE_SEND in call to auth_server_authenticate.

Thu Jul  4 16:56:53 1996  Michael I. Bushnell, p/BSG  <mib@gnu.ai.mit.edu>

	* io-write.c (netfs_S_io_write): Bother implementing O_APPEND.

	* io-identity.c (netfs_S_io_identity): Don't take address of ID in
 	call to fshelp_get_identity.

Wed Jul  3 11:54:46 1996  Michael I. Bushnell, p/BSG  <mib@gnu.ai.mit.edu>

	* dir-mkfile.c (netfs_S_dir_mkfile): Return right with MAKE_SEND,
 	not COPY_SEND.

	* io-identity.c (netfs_S_io_identity): Use fshelp_get_identity
 	instead of creating port ourselves.
	* netfs.h (struct node): Delete member identity.
	* make-node.c (netfs_make_node): Don't initialize NP->identity.
	* drop-node.c (netfs_drop_node): Don't deallocate NP->identity.

Thu Jun 27 17:57:30 1996  Michael I. Bushnell, p/BSG  <mib@gnu.ai.mit.edu>

	* Makefile (LCLHDRS): Add execserver.h.

Thu Jun 27 00:24:57 1996  Miles Bader  <miles@gnu.ai.mit.edu>

	* append-std-options.c: New file.
	* Makefile (OTHERSRCS): Add append-std-options.c.

Wed Jun 26 15:57:13 1996  Miles Bader  <miles@gnu.ai.mit.edu>

	* netfs.h: Change options parsing interface to match libdiskfs's:
	(netfs_set_options, netfs_get_options): Updated to inew interface.
	(netfs_runtime_argp, netfs_std_runtime_argp, netfs_std_startup_arg): 
	New variables.
	(netfs_append_std_options): New declaration.
	(netfs_parse_runtime_options, netfs_unparse_runtime_options):
	Functions removed.
	* set-options.c (std_runtime_options): Variable removed.
	(parse_runtime_opt): Function removed.
	(netfs_set_options): Change to use fshelp_set_options.
	* fsys-set-options.c (netfs_S_fsys_set_options): Don't convert
	options string into argv vector.
	* fsys-get-options.c (netfs_S_fsys_get_options): Use
	fshelp_return_malloced_buffer to prepare return value.
	* file-get-fs-options.c (netfs_S_file_get_fs_options): Likewise.
	* get-options.c (netfs_get_options): Call netfs_append_std_options.
	* std-startup-argp.c, std-runtime-argp.c, runtime-argp.c: New files.
	* parse-runtime-options.c, unparse-runtime-options.c: Files removed.
	* Makefile (OTHERSRCS): Add runtime-argp.c, std-runtime-argp.c,
	& std-startup-argp.c.  Remove parse-runtime-options.c &
	unparse-runtime-options.c.

Tue May 14 14:05:33 1996  Michael I. Bushnell, p/BSG  <mib@gnu.ai.mit.edu>

	* init-init.c (netfs_fsys_identity): New variable.
	(netfs_init): Initialize netfs_fsys_identity.
	* drop-node.c (netfs_drop_node): Destroy NP->identity if it's set.
	* make-node.c (netfs_make_node): Initialize NP->identity.
	* netfs.h (struct node): New member `identity'.
	(netfs_fsys_identity): New variable.
	* Makefile (IOSRCS): Add io-identity.c.
	* io-identity.c: New file.

Sat May 11 01:24:31 1996  Miles Bader  <miles@gnu.ai.mit.edu>

	* startup-argp.c (parse_startup_opt): Use ARGP_ERR_UNKNOWN instead
	of EINVAL.

Thu May  9 18:54:11 1996  Michael I. Bushnell, p/BSG  <mib@gnu.ai.mit.edu>

	* file-get-storage-info.c (netfs_S_file_get_storage_info): fixup

Thu May  9 18:15:40 1996  Miles Bader  <miles@gnu.ai.mit.edu>

	* file-get-storage-info.c (netfs_S_file_get_storage_info): Change
	to new interface.

Thu May  9 11:53:49 1996  Michael I. Bushnell, p/BSG  <mib@gnu.ai.mit.edu>

	* make-protid.c (netfs_make_protid): Use new ports interface; if
	it fails return zero.
	
	* io-select.c (netfs_S_io_select): No longer has TAG arg.
	
	* io-reauthenticate.c (netfs_S_io_reauthenticate): Don't pass
 	right for USER to auth_server_authenticate.

	* file-sync.c (netfs_S_file_sync): Accept and ignore new omitmeta
 	arg.

	* dir-rename.c (netfs_S_dir_rename): Accept and pass through excl
 	flag.
	* dir-link.c (netfs_S_dir_link): Likewise.
	* netfs.h (netfs_attempt_link): Add excl parm.
	(netfs_attempt_rename): Likewise.

	* netfs.h (netfs_attempt_statfs): Use struct statfs, not old
 	deprecated structure.
	* file-statfs.c (netfs_S_file_statfs): Use new struct statfs.

	* netfs.h: ioserver.h -> iohelp.h.

Mon Apr 29 16:27:37 1996  Michael I. Bushnell, p/BSG  <mib@gnu.ai.mit.edu>

	* file-getcontrol.c (netfs_S_file_getcontrol): Use correct args to
 	ports_create_port.

Sat Apr 27 06:02:03 1996  Roland McGrath  <roland@delasyd.gnu.ai.mit.edu>

	* file-getcontrol.c: Use ports_create_port instead of
 	ports_allocate_port, and notice the error.

Wed Apr 24 16:02:51 1996  Michael I. Bushnell, p/BSG  <mib@gnu.ai.mit.edu>

	* io-seek.c (netfs_S_io_seek): Bother to set *NEWOFFSET.

Fri Apr 12 16:21:53 1996  Michael I. Bushnell, p/BSG  <mib@gnu.ai.mit.edu>

	* file-exec.c (netfs_S_file_exec): Copy credential using
	netfs_copy_credential before handing it off to netfs_make_protid.

	* dir-lookup.c (netfs_S_dir_lookup): netfs_make_protid's second
	arg must be a real credential; the unauthenticated port creation
	frob now makes a genuine (but empty) credential.

Thu Apr 11 18:10:29 1996  Michael I. Bushnell, p/BSG  <mib@gnu.ai.mit.edu>

	* Makefile (fsys-MIGSFLAGS, fs-MIGSFLAGS, io-MIGSFLAGS,
 	ifsock-MIGSFLAGS): Find mutations.h in $(srcdir).

Wed Apr  3 14:47:37 1996  Michael I. Bushnell, p/BSG  <mib@gnu.ai.mit.edu>

	* io-reauthenticate.c (netfs_S_io_reauthenticate): In check for
	deallocation of aux_gids; check against AGBUF, not AUBUF.

Tue Apr  2 09:14:30 1996  Michael I. Bushnell, p/BSG  <mib@gnu.ai.mit.edu>

	* io-write.c: Include <fcntl.h>.
	(netfs_S_io_write): Verify that the user has the file open for
	writing.
	* io-read.c: Include <fcntl.h>.
 	(netfs_S_io_read): Verify that the user has the file open for
	reading.

Mon Apr  1 16:02:29 1996  Michael I. Bushnell, p/BSG  <mib@gnu.ai.mit.edu>

	* fsstubs.c (netfs_S_file_exec): Remove stub.
	* Makefile (FSSRCS): Add file-exec.c.
	* execserver.h: New file.
	* file-exec.c: New file.

Mon Apr  1 14:21:12 1996  Miles Bader  <miles@gnu.ai.mit.edu>

	* parse-runtime-options.c (netfs_parse_runtime_options): Pass new
	arg to arg_parse.

Tue Mar 19 14:12:32 1996  Michael I. Bushnell, p/BSG  <mib@gnu.ai.mit.edu>

	* Makefile (LCLHDRS): Add callbacks.h misc.h modes.h mutations.h
 	priv.h.

Mon Mar 18 11:09:05 1996  Michael I. Bushnell, p/BSG  <mib@gnu.ai.mit.edu>

	* netfs.h (netfs_startup): Add declaration.

	* netfs.h (netfs_protid_class, netfs_control_class,
 	netfs_port_bucket, netfs_root_node, netfs_auth_server_port): Make
 	this extern.

	* fsys-getroot.c: Include "callbacks.h".

	* file-set-translator.c (makedev): New macro.

Thu Mar 14 16:47:14 1996  Michael I. Bushnell, p/BSG  <mib@gnu.ai.mit.edu>

	* netfs.h (netfs_attempt_mkdev): Don't pass dev_t in pieces.
	* file-set-translator.c (netfs_S_file_set_translator): In call to
	netfs_attempt_mkdev don't pass MAJOR and MINOR in pieces.

Tue Mar 12 14:57:26 1996  Michael I. Bushnell, p/BSG  <mib@gnu.ai.mit.edu>

	* fsys-getroot.c (netfs_S_fsys_getroot): Add translator linkage
	code.
	* dir-lookup.c (netfs_S_dir_lookup): Fix up and enable translator
	linkage code.

	* netfs.h (netfs_attempt_chmod): Doc fix.
	(netfs_attempt_mksymlink, netfs_attempt_mkdev,
	netfs_set_translator): New declarations.
	* file-set-translator.c: New file.
	* fsstubs.c (netfs_S_file_set_translator): Delete function.
	* Makefile (FSSRCS): Add file-set-translator.c.

Mon Mar 11 16:44:08 1996  Michael I. Bushnell, p/BSG  <mib@gnu.ai.mit.edu>

	* fsstubs.c (netfs_S_file_get_translator): Remove function.
	* file-get-translator.c: New file.
	* Makefile (FSSRCS): Add file-get-translator.c.

Mon Mar  4 13:36:36 1996  Miles Bader  <miles@gnu.ai.mit.edu>

	* fsys-set-options.c, fsys-get-options.c, file-get-fs-options.c:
	New files.
	* netfs.h (netfs_startup_argp, netfs_get_options,
	netfs_set_options, netfs_parse_runtime_options,
	netfs_unparse_runtime_options): New declarations.
	* Makefile (OTHERSRCS): Add startup-argp.c, set-options.c,
	get-options.c, parse-runtime-options.c, & unparse-runtime-options.c.
	(FSYSSRCS): Add fsys-set-options.c & fsys-get-options.c.
	(FSSRCS): Add file-get-fs-options.c.
	* unparse-runtime-options.c (netfs_unparse_runtime_options): Add
	comment, and remove bogus semi.
	* fsysstubs.c (netfs_S_fsys_set_options, netfs_S_fsys_get_options):
	Functions removed.
	* fsstubs.c (netfs_S_file_get_fs_options): Function removed.
	* parse-runtime-options.c: Include "netfs.h", not "priv.h".
	* set-options.c: Likewise.
	(parse_runtime_opt): New function.
	* priv.h: Include <hurd/hurd_types.h>

Tue Apr 11 11:15:30 1995  Michael I Bushnell  <mib@duality.gnu.ai.mit.edu>

	* Makefile: New file.

