1999-10-22  Roland McGrath  <roland@baalperazim.frob.com>

	* socket-ops.c (S_socket_getopt): Implement the call.
	All options supported by the code in linux-inet are in
	fact of type int, so we can support just that one size.
	(This is still a bogus untyped interface!)

1999-09-13  Roland McGrath  <roland@baalperazim.frob.com>

	* io-ops.c: Reverted changes related to io_map_segment.

1999-09-09  Thomas Bushnell, BSG  <tb@mit.edu>

	* ethernet.c (ethernet_open): Don't start the input work thread
	here.
	(more_packets, mark_bh, input_work_thread): Move
	these to ...
	* devices.c: ... here.
	Also include "pfinet.h" instead of list of <> includes.
	* main.c (main): Launch input work thread here.
	* pfinet.h (input_work_thread): Declare function.

	* devices.c (add_device): Remove unused function.
	* pfinet.h (incoming_net_packet): Remove unused declaration.

1999-09-07  Thomas Bushnell, BSG  <tb@mit.edu>

	* io-ops.c (S_io_map_segment): New function.

1999-07-11  Roland McGrath  <roland@baalperazim.frob.com>

	* pfinet.h: Add #include <sys/mman.h> for munmap decl.

1999-07-10  Roland McGrath  <roland@baalperazim.frob.com>

	* io-ops.c: Add #include <sys/mman.h> for munmap decl.

1999-07-09  Thomas Bushnell, BSG  <tb@mit.edu>

	* io-ops.c (S_io_read): Use mmap instead of vm_allocate.
	* socket-ops.c (S_socket_whatis_address): Likewise.

1999-07-03  Thomas Bushnell, BSG  <tb@mit.edu>

	* io-ops.c (S_io_read): Use munmap instead of vm_deallocate.
	(S_io_reauthenticate): Likewise.

1999-06-13  Roland McGrath  <roland@baalperazim.frob.com>

	* main.c (trivfs_goaway): Exit if there are no socket ports.

Sun Mar 14 18:33:54 1999  Thomas Bushnell, BSG  <tb@mit.edu>

	* ethernet.c (ether_filter): Use a shorter filter program.
	(ether_filter_len): Compute more safely.

1999-02-28  Roland McGrath  <roland@baalperazim.frob.com>

	* main.c (S_startup_dosync): Use ports_class_iterate.
	(sigterm_handler): Likewise.

Tue Feb 16 05:50:27 1999  Thomas Bushnell, BSG  <tb@mit.edu>

	* io-ops.c (S_io_revoke): New function.  Don't attempt to
	implement.  (Other systems don't even permit non-file revokes.)

1998-10-24  Roland McGrath  <roland@baalperazim.frob.com>

	* ethernet.c (ethernet_open): Check error return from device_open and
	device_set_filter.
	(setup_ethernet_device): Check error return from device_get_status.

	* ethernet.c (ethername): Remove static variable.
	(setup_ethernet_device): Don't set it.
	(ethernet_open): Don't use it; use DEV->name instead.

1998-09-04  Roland McGrath  <roland@baalperazim.frob.com>

	* loopback.c (loopback_type_trans): Return u_int16_t.

Fri Apr 24 15:43:07 1998  Thomas Bushnell, n/BSG  <tb@mit.edu>

	* io-ops.c (S_io_select): When returning EINTR after cancellation,
	deallocate REPLY because the stub won't do it for us.  Reported by
	UCHIYAMA Yasushi (uch@nop.or.jp).

1997-08-25  Miles Bader  <miles@gnu.ai.mit.edu>

	* io-ops.c (S_io_write): Negate linux error codes before returning.

1997-08-19  Miles Bader  <miles@gnu.ai.mit.edu>

	* linux-inet/tcp.c (tcp_conn_request): SK->err holds errno values,
	not linux negative errno return vals.

Wed Aug 20 14:05:52 1997  Thomas Bushnell, n/BSG  <thomas@gnu.ai.mit.edu>

	* main.c (main): New args for
	ports_manage_port_operations_multithread.

Fri Aug  8 11:47:08 1997  Thomas Bushnell, n/BSG  <thomas@gnu.ai.mit.edu>

	* linux-inet/tcp.c (tcp_check): Move to end of file so it isn't
	inlined and can be profiled easily.
	* linux-inet/udp.c (udp_check): Likewise.

Mon Jul 21 14:58:13 1997  Thomas Bushnell, n/BSG  <thomas@gnu.ai.mit.edu>

	* Makefile (HURDLIBS): Add iohelp.

	* main.c (trivfs_goaway): If FSYS_GOAWAY_FORCE is set, then go
	away, otherwise, continue to return EBUSY.

Fri Apr 25 10:46:49 1997  Miles Bader  <miles@gnu.ai.mit.edu>

	* options.c (trivfs_append_args): Renamed from trivfs_get_options.
	Don't initialize ARGZ/ARGZ_LEN.

Tue Feb  4 16:53:19 1997  Miles Bader  <miles@gnu.ai.mit.edu>

	* socket-ops.c (S_socket_send): Don't deref ADDR if it's 0.
	(S_socket_bind): Return EADDRNOTAVAIL if ADDR is 0.

Fri Oct 25 20:02:17 1996  Thomas Bushnell, n/BSG  <thomas@gnu.ai.mit.edu>

	* loopback.c (loopback_type_trans): New function.
	(setup_loopback_device): Bother to mark interface up
	too.  Set LOOPBACK_DEV.type_trans.

Thu Oct 24 22:38:55 1996  Thomas Bushnell, n/BSG  <thomas@gnu.ai.mit.edu>

	* main.c (main): Call setup_loopback_device before parsing args
	(and thus before the ethernet device shows up).
	* loopback.c: New file.
	* Makefile (SRCS): Add loopback.c.
	* pfinet.h (loopback_dev): New variable.

	* pfinet.h (ip_rt_del): New prototype.

Thu Sep 12 16:47:24 1996  Thomas Bushnell, n/BSG  <thomas@gnu.ai.mit.edu>

	* Makefile (HURDLIBS): New variable.
	(pfinet): Omit special dependency.

	* Makefile (vpath %.c): Put this after Makeconf inclusion so it
	catches setting of $(srcdir) there.

Fri Sep  6 16:46:43 1996  Thomas Bushnell, n/BSG  <thomas@gnu.ai.mit.edu>

	* socket-ops.c (S_socket_recv): Bother to pass
	USER->sock->userflags through to the recvfrom routine.

Sat Jul 20 15:48:29 1996  Michael I. Bushnell, p/BSG  <mib@gnu.ai.mit.edu>

	* Makefile (lndist-asm-files): Look for files in $(srcdir).
	(lndist-linux-files): Likewise.
	(lndist-linux-inet-files): Likewise.

Fri Jul 19 09:39:08 1996  Miles Bader  <miles@gnu.ai.mit.edu>

	* pfinet.h (make_sock_user): Declaration updated.

Thu Jul 18 23:19:07 1996  Michael I. Bushnell, p/BSG  <mib@gnu.ai.mit.edu>

	* misc.c (make_sock_user): New parm `noinstall'; if it's set use
	non-installing version of ports_create_port.  All callers
	changed.
	* io-ops.c (S_io_reauthenticate): Install NEWUSER port right into
	portset after it's fully initialized.

Sat Jul 13 20:18:18 1996  Michael I. Bushnell, p/BSG  <mib@gnu.ai.mit.edu>

	* io-ops.c (S_io_reauthenticate): Repeat auth_server_authenticate
 	for as long as we get EINTR.  Deal with other errors without
 	crashing.

Sun Jul  7 21:29:42 1996  Michael I. Bushnell, p/BSG  <mib@gnu.ai.mit.edu>

	* io-ops.c (S_io_reauthenticate): Don't use unsafe MOVE_SEND in
 	call to auth_server_authenticate.

Fri Jul  5 19:42:54 1996  Michael I. Bushnell, p/BSG  <mib@gnu.ai.mit.edu>

	* ethernet.c (setup_ethernet_device): Linux's device `mtu' member
 	does not include the hardware header size; subtract that off the
 	value the kernel specifies as maximum packet size in setting
 	ETHER_DEV.mtu.

Thu Jun 27 10:14:10 1996  Michael I. Bushnell, p/BSG  <mib@gnu.ai.mit.edu>

	* Makefile (lndist): Add lndist-asm-files.
	(lndist-asm-files): New rule.
	(ASMHEADERS): New variable.
	($(top_srcdir)/hurd-snap/$(dir)/asm): New rule.

Tue Jun 25 14:00:07 1996  Miles Bader  <miles@gnu.ai.mit.edu>

	* linux-inet/route.c (ip_rt_del): New function.
	* linux-inet/route.h (ip_rt_del): New declaration.

	* options.c (trivfs_get_options): Initialize *ARGZ & *ARGZ_LEN.
	(parse_opt): Fix test for address-less netmask.
	Fix byte order when using IN_* macros.
	Base default netmask on dev->pa_addr, not in->address.
	Don't clear dev->pa_addr.
	Delete old routing entries before adding new ones.
	(trivfs_get_options): Add & use ADD_ADDR_OPT macro.
	(parse_hook_add_interface): Initialize H->curint->device.

Mon Jun 24 16:48:51 1996  Miles Bader  <miles@gnu.ai.mit.edu>

	* main.c (sigterm_handler): Renamed from sighup_handle.  Make void.
	Deal with SIGTERM instead of SIGHUP.
	(main): Use SIGTERM & sigterm_handler instead of SIGHUP &c.

	* options.c (parse_hook_add_interface): Realloc the correct number
	of bytes.

Mon Jun 24 16:33:55 1996  Michael I. Bushnell, p/BSG  <mib@gnu.ai.mit.edu>

	* main.c (sighup_handle): New function.
	(arrange_shutdown_notification): Register SIGHUP handler.

Mon Jun 24 12:44:17 1996  Miles Bader  <miles@gnu.ai.mit.edu>

	* options.c (parse_opt): Don't fail if there were no options.
	(RETURN): New macro.
	(PERR, FAIL): Use RETURN instead of return to free memory if nec.

Fri Jun 21 16:42:29 1996  Miles Bader  <miles@gnu.ai.mit.edu>

	* main.c (main): Pass ARGC & ARGV to argp_parse in the correct order.

Thu Jun 20 22:39:17 1996  Miles Bader  <miles@gnu.ai.mit.edu>

	* options.c: Renamed from opts.c.
	(parse_opt): Fix lots of typos.
	(trivfs_get_options): New function.
	(get_opts, trivfs_S_fsys_get_options, trivfs_S_file_get_fs_options):
	Functions removed.
	<netinet/in.h>, <arpa/inet.h>: New includes.
	* Makefile (pfinet): Depend on ../libfshelp/libfshelp.a &
	../libshouldbeinlibc/libshouldbeinlibc.a.
	(SRCS): Add options.c.

Thu Jun 20 19:47:40 1996  Michael I. Bushnell, p/BSG  <mib@gnu.ai.mit.edu>

	* main.c: Include <hurd/startup.h> and <string.h>.
 	(shutdown_notify_class): Declare variable.
	(S_startup_dosync): Give enough args to ports_lookup_port.
	(S_startup_dosync/do1): Return a value.
	(arrange_shutdown_notification): Correct spelling of
	ports_create_port.  Initialize shutdown_notify_class.
	(find_device): Construct arg to strcmp correctly.  Correct
	spelling of ENXIO.

Wed Jun 19 18:46:35 1996  Miles Bader  <miles@gnu.ai.mit.edu>

	* opts.c (trivfs_S_fsys_set_options): Function removed.
	(trivfs_runtime_argp): New variable.

Sun Jun 16 22:45:54 1996  Miles Bader  <miles@gnu.ai.mit.edu>

	* opts.c (parse_opt): Rename ERR macro to FAIL.  Use argp_failure.

Sat Jun 15 19:47:06 1996  Miles Bader  <miles@gnu.ai.mit.edu>

	* main.c (main): Rearrange for arg parsing some more.
	(enumerate_devices): New function.
	(pfinet_argp): New declaration.
	(already_open): Make global.
	<error.h>, <argp.h>: New includes.

Fri Jun 14 15:41:57 1996  Miles Bader  <miles@gnu.ai.mit.edu>

	* main.c (find_device): New function.
	(main): Rearrange to use new argument parsing.

Thu Jun 13 16:55:42 1996  Michael I. Bushnell, p/BSG  <mib@gnu.ai.mit.edu>

	* Makefile (MIGSRCS): Add startup_notifyServer.c.
	* main.c (S_startup_dosync, arrange_shutdown_notification): New
 	functions.
	(pfinet_demuxer): Call startup_notify_server.
	(main): Call arrange_shutdown_notification).

Tue May 14 14:12:25 1996  Michael I. Bushnell, p/BSG  <mib@gnu.ai.mit.edu>

	* main.c (main): Initialize fsys_identity.
	* misc.c (sock_alloc): Initialize SOCK->identity.
	(sock_release): Destroy SOCK->identity if it's been set.
	* io-ops.c (S_io_identity): New function.
	* pfinet.h (fsys_identity): New variable.
	* linux/net.h (struct socket) [_HURD_]: New member `identity'.

	* ethernet.c (ethernet_open): Delete superfluous arg to
 	assert_perror.

Fri May 10 16:56:52 1996  Miles Bader  <miles@gnu.ai.mit.edu>

	* misc.c (make_sock_user): Pass correct args to ports_create_port.

	* ethernet.c (ethernet_open): Pass in ERRNO to assert_perror.

Thu May  9 20:27:28 1996  Michael I. Bushnell, p/BSG  <mib@gnu.ai.mit.edu>

	* io-ops.c (S_io_reauthenticate): Use new auth_server_authenticate
 	interface.

	* io-ops.c (S_io_select): Drop ID_TAG arg.

	* ethernet.c (ethernet_thread): Return any_t.
	(input_work_thread): Likewise.

	* ethernet.c (ethernet_open): Use new ports_create_port call.
	* socket-ops.c (S_socket_create_address): Likewise.
	* misc.c (make_sock_user): Likewise.
	(make_sockaddr_port): Likewise.

Wed Apr 24 18:35:50 1996  Roland McGrath  <roland@delasyd.gnu.ai.mit.edu>

	* main.c (main): Take third cmdline arg and add gateway route.

Mon Apr 15 12:53:24 1996  Michael I. Bushnell, p/BSG  <mib@gnu.ai.mit.edu>

	* Makefile (CPPFLAGS): Look for config.h in $(srcdir).
	(io-MIGSFLAGS, socket-MIGSFLAGS): Look for mutations.h in
	$(srcdir).
	(vpath %.c): Find linux-inet dir under #(srcdir)>
	(SRCS): Add time.c.
	(LCLHDRS, LINUXHDRS, FROBBEDLINUXHEADERS): New variables.
	(lndist, lndist-linux-inet-files, lndist-linux-files,
	$(top-srcdir)/hurd-snap/$(dir)/linux-inet,
	$(top-srcdir)/hurd-snap/$(dir)/linux): New targets.

Mon Feb 26 13:36:14 1996  Michael I. Bushnell, p/BSG  <mib@gnu.ai.mit.edu>

	* misc.c (end_using_sockaddr_port): Only call ports_port_deref if
	arg is valid.
	(end_using_socket_port): Likewise.

	* linux/interrupt.h (mark_bh): Remove stubby inline, replace
	with real declaration.
	* pfinet.h (packet_queue_lock): New variable.
	* sched.c (packet_queue_lock): Provide initialization.
	* ethernet.c (ethernet_open): Put READPT in etherport_bucket
	instead of pfinet_bucket.  Fork ethernet_thread and
	input_work_thread before returning.
	(more_packets, etherport_bucket): New variables.
	(input_work_thread, ethernet_thread, mark_bh): New functions.

	* main.c (pfinet_demuxer): Don't use call ethernet_demuxer.

Thu Feb 22 17:54:25 1996  Michael I. Bushnell, p/BSG  <mib@gnu.ai.mit.edu>

	* ethernet.c (ethernet_open): Request maximum queue limit
	on our read port.

Thu Feb  8 18:32:33 1996  Michael I. Bushnell, p/BSG  <mib@gnu.ai.mit.edu>

	* socket-ops.c (S_socket_connect): Don't return EINVAL for
	SS_CONNECTED state.

Mon Jan 22 13:47:47 1996  Roland McGrath  <roland@churchy.gnu.ai.mit.edu>

	* timer-emul.c (init_time): There are *still* a million microseconds to
	the second.

Thu Jan 18 12:37:57 1996  Michael I. Bushnell, p/BSG  <mib@gnu.ai.mit.edu>

	* mapped-time.h (fetch_jiffies): Uh, duh, there are a million
	microseconds in a second, not just a thousand.

Tue Dec 26 19:29:16 1995  Miles Bader  <miles@gnu.ai.mit.edu>

	* io-ops.c (S_io_select): Add REPLY parameter, and request
	notification if it dies.
	* mutations.h (IO_SELECT_REPLY_PORT): New def.

Thu Dec 14 18:50:07 1995  Michael I. Bushnell, p/BSG  <mib@gnu.ai.mit.edu>

	* ethernet.c (ethernet_open): Don't set filter priority high.

Mon Dec 11 13:23:49 1995  Miles Bader  <miles@gnu.ai.mit.edu>

	* socket-ops.c (S_socket_recv): Whoops, incorrectly negated this
	particular return value.  Rename the variable `recvd' to make
	things more clear.
	(S_socket_send): Ditto (`sent'), plus correctly check the return
	value when deciding whether to deallocate ADDR's send right.

Thu Dec  7 18:24:37 1995  Miles Bader  <miles@gnu.ai.mit.edu>

	* socket-ops.c (S_socket_recv, S_socket_bind, S_socket_send):
	Negate error return values from linux code.
	(S_socket_setopt): Implement.

Wed Aug 23 14:20:48 1995  Miles Bader  <miles@churchy.gnu.ai.mit.edu>

	* Makefile (pfinet): Put all dependencies here.
	(HURDLIBS): Removed.
