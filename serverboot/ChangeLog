1999-05-23  Roland McGrath  <roland@baalperazim.frob.com>

	* default_pager.c (new_partition): Fix arg order in printf for
	linux-2.2 signature page.

1999-05-20  Roland McGrath  <roland@baalperazim.frob.com>

	* default_pager.c (new_partition): Fix SWAP-SPACE page handling.

1999-05-17  Roland McGrath  <roland@baalperazim.frob.com>

	* default_pager.c (new_partition): Deallocate signature page when
	rejecting it for wrong version.  Fix typo in SWAPSPACE2 v1 bad block
	bitmap handling.  Free bitmap and partition structure if we reject the
	partition signature.
	Reported by Kalle Olavi Niemitalo <tosi@ees2.oulu.fi>.

	* default_pager.c (new_partition): Print out for
	CHECK_LINUX_SIGNATURE<0 case.

1999-05-15  Roland McGrath  <roland@baalperazim.frob.com>

	* default_pager.c (new_partition): Check if requested partition is
	already in our list, and refuse it.

	* bootstrap.c (main): Remove vars HAD_A_PARITION, DOING_DEFAULT_PAGER.
	Remove $(default-pager) boot script tag.  We always stick around and
	act as the default pager (this was already the case, just removed some
	dead code).  Don't print anything about having no swap partitions,
	since that is a fine way to boot (just use swapon later).

	* default_pager.c (new_partition): Print out partition name and size
	when no signature.

1998-09-06  OKUJI Yoshinori  <okuji@kuicr.kyoto-u.ac.jp>

	* bunzip2.c: New file.
	* load.c (GZIP) (BZIP2): New cpp constants.
	(boot_script_exec_cmd): If GZIP is defined, gunzip engine is enabled.
	If BZIP2 is defined, bunzip2 engine is enabled.
	* Makefile (SRCS): Add bunzip2.c.
	(UNZIP_OBJS): Add do-bunzip2.o.
	(CPPFLAGS): Add -DGZIP, -DBZIP2 and -DSMALL_BZIP2.

1998-09-03  OKUJI Yoshinori  <okuji@kuicr.kyoto-u.ac.jp>

	* gunzip.c: New file.
	Copy libstore/gunzip.c and modify for use in serverboot.
	* load.c (struct stuff): Add members, image_addr and image_size.
	(mem_read) (mem_read_exec): New functions.
	(boot_script_exec_cmd): Add gzexe feature.
	* Makefile: Add unzip stuffs.

1999-03-06  Roland McGrath  <roland@baalperazim.frob.com>

	* def_pager_setup.c (default_pager_setup): #if 0 out unused function.

	* default_pager.c (default_pager_paging_file): Pass 0 for new
	LINUX_SIGNATURE arg to add_paging_file.

	* bootstrap.c (main: scrript_paging_file): Pass LINUX_SIGNATURE arg
	through to add_paging_file.

1999-02-27  Roland McGrath  <roland@baalperazim.frob.com>

	* def_pager_setup.c (add_paging_file): New arg CHECK_LINUX_SIGNATURE,
	pass down to create_paging_partition.
	* default_pager.c (create_paging_partition): New arg
	CHECK_LINUX_SIGNATURE, pass down new_partition.
	(new_partition): New arg CHECK_LINUX_SIGNATURE: if not < 0,
	check first page of swap for Linux 2.0 or 2.2 signature page and obey
	its bad-block map; if > 0, refuse the partition if no signature found.
	* bootstrap.c (main): Add new boot script functions
	`add-raw-paging-file', `add-linux-paging-file'.  Make those
	and `add-paging-file' all call add_paging_file with new
	LINUX_SIGNATURE arg of -1, 1, and 0, respectively.
	* default_pager.c (create_paging_partition): If new_partition returns
	null, return and do nothing more.

1998-07-25  Roland McGrath  <roland@baalperazim.frob.com>

	* default_pager.c (pager_read_offset): Cast NO_BLOCK twice, to real
	return type of this function.

Tue May 12 12:11:36 1998  Thomas Bushnell, n/BSG  <tb@mit.edu>

	* bootstrap.c (parse_script): Free BUF before returning.  Reported
 	by Katusya Tanaka (wyvern@pb3.so-net.ne.jp).

1997-07-15  Miles Bader  <miles@gnu.ai.mit.edu>

	* bootstrap.c (main): Rearrange default pager initialization.

	* bootstrap.c (safe_gets): Use strchr instead of index.
	: Include <string.h>

	* bootstrap.c (main): Change "(bootstrap)" to "(serverboot)" in msgs.
	* load.c (boot_script_exec_cmd): Likewise.

1997-07-09  Miles Bader  <miles@gnu.ai.mit.edu>

	* bootstrap.c (main): Don't exit when no paging partition.

1997-07-08  Miles Bader  <miles@gnu.ai.mit.edu>

	* bootstrap.c: Don't include "translate_root.h".
	(main): Don't call translate_root.
	Pass more than a single character to safe_gets.
	(DEFAULT_ROOT): New macro.
	(safe_gets): Make sure a newline exists before removing it.
	Ensure that the cursor moves to the beginning of the next line.
	* translate_root.c, translate_root.h: Files removed.
	* Makefile (SRCS): Remove translate_root.c.
	(LCLHDRS): Remove translate_root.h.

Fri Jun 20 15:37:15 1997  Thomas Bushnell, n/BSG  <thomas@gnu.ai.mit.edu>

	* bootstrap.c (main/script_paging_file): Instead of returning an
	error use new variable `had_a_partition' to record whether we
	successfully opened a partition.
	(main/script_default_pager): Only start pager if HAD_A_PARTITION;
	otherwise print warning message.

Mon Jun 16 11:52:40 1997  Thomas Bushnell, n/BSG  <thomas@gnu.ai.mit.edu>

	* Makefile (installationdir): Use `=' to set this instead of :=;
	$(prefix) is not yet available and `=' postpones the evaluation
	properly.   Reported by Marcus G. Daniels,
	marcus@cathcart.sysc.pdx.edu.

Tue Jun 10 21:54:52 1997  Thomas Bushnell, n/BSG  <thomas@gnu.ai.mit.edu>

	* disk_inode.h (struct icommon): Use short instead of uid_t/gid_t
	in structure definition; those are now 32 bit types.

	* bootstrap.c (main): Support running from command line too; this
	is useful at least for simple debugging.

1997-06-09  Miles Bader  <miles@gnu.ai.mit.edu>

	* Makefile (LCLHDRS): Add mach-exec.h.

Thu May  1 18:40:53 1997  Thomas Bushnell, n/BSG  <thomas@gnu.ai.mit.edu>

	* bootstrap.c (cthread_stack_size): Don't set special value here;
	use the default.

Wed Apr 30 12:01:53 1997  Thomas Bushnell, n/BSG  <thomas@gnu.ai.mit.edu>

	* default_pager.c (default_pager_default_thread): Now that this is
 	forked, rather than run directly by the first thread, we have to
 	gain kernel privileges to acquire reserved pages.

Fri Apr 18 16:44:49 1997  Thomas Bushnell, n/BSG  <thomas@gnu.ai.mit.edu>

	* wiring.c (__vm_allocate): New function.

Wed Apr 16 14:18:28 1997  Thomas Bushnell, n/BSG  <thomas@gnu.ai.mit.edu>

	* default_pager.c (debug): Turn off.

Mon Apr 14 12:50:20 1997  Thomas Bushnell, n/BSG  <thomas@gnu.ai.mit.edu>

	* default_pager.c: Remove debugging printfs.

Thu Apr 10 15:10:25 1997  Thomas Bushnell, n/BSG  <thomas@gnu.ai.mit.edu>

	* Makefile (installationdir): Set variable.

Wed Apr  9 13:57:44 1997  Thomas Bushnell, n/BSG  <thomas@gnu.ai.mit.edu>

	* default_pager.c (default_pager_default_thread): New function.
	Delete old variable with this name, it was never used.
	(default_pager): Fork default_pager_default_thread instead of
	doing it here to avoid the possibility that we are on a tiny
	stack.  Current thread dies.

Thu Apr  3 20:00:58 1997  Thomas Bushnell, n/BSG  <thomas@gnu.ai.mit.edu>

	* elf-load.c (exec_load): Include <elf.h> instead of
	<mach/exec/elf.h>.  Include "mach-exec.h" instead of
	<mach/exec/elf.h>.
	(exec_load) [i386]: Check for i386 types directly; abandon old
	MY_EI_DATA and MY_E_MACHINE.
	* load.c: Include "mach-exec.h" instead of <mach/exec/elf.h>.
	* exec.c: Likewise.
	* mach-exec.h: New file.

Wed Mar 19 14:45:27 1997  Thomas Bushnell, n/BSG  <thomas@gnu.ai.mit.edu>

	* panic.c (panic): Clear possible errors on stdout before printing
	panic string.

Mon Mar 17 13:13:50 1997  Thomas Bushnell, n/BSG  <thomas@gnu.ai.mit.edu>

	* wiring.c (wire_all_memory): Don't attempt wire if PROTECTION is
	VM_PROT_NONE.

	* panic.c (panic): Be more informative about where the error is
	coming from.

	* default_pager.c (create_paging_partition): Don't print
	gratuitous output noise.
	* load.c (boot_script_exec_cmd): Likewise.

Wed Mar 12 10:53:00 1997  Thomas Bushnell, n/BSG  <thomas@gnu.ai.mit.edu>

	* ext2_file_io.c (ext2_open_file): Clear FP before beginning
	work.
	* ffs_file_io.c (ffs_open_file): Likewise.
	* minix_file_io.c (minix_open_file): Likewise.

	* bootstrap.c (printf_init, safe_gets): New functions.
	* console.c: Deleted file.
	* Makefile (SRCS): Omit console.c and gets.c.

	* load.c (read_symtab_from_file): Comment out body of function.
	We don't want this.

	* defs.h: Comment out redefinitions of common types.

	* default_pager.c: Include <cthreads.h> instead of
	<mach/cthreads.h>.
	* file_io.h: Likewise.
	* kalloc.c: Likewise.

	* panic.c: Include <varargs.h> instead of <sys/varargs.h>.

	* default_pager.c (pager_read_offset): Cast return of NO_BLOCK
	properly.

Mon Mar 10 17:07:50 1997  Thomas Bushnell, n/BSG  <thomas@gnu.ai.mit.edu>

	* load.c: Find boot_script.h in ../boot.
	* bootstrap.c: Likewise.

	* bootstrap.c (boot_panic): Repair syntax.

	* strfcns.c: Include <varargs.h> instead of <sys/varargs.h>.
	* load.c: Likewise.
